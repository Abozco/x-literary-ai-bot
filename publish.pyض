import os
import tweepy
from openai import OpenAI

# =========================
# ุฅุนุฏุงุฏ OpenAI
# =========================
openai_client = OpenAI(
    api_key=os.getenv("AI_API_KEY")
)

# =========================
# ุฅุนุฏุงุฏ ุญุณุงุจ X (Twitter)
# =========================
client = tweepy.Client(
    bearer_token=os.getenv("X_BEARER_TOKEN"),
    consumer_key=os.getenv("X_API_KEY"),
    consumer_secret=os.getenv("X_API_SECRET"),
    access_token=os.getenv("X_ACCESS_TOKEN"),
    access_token_secret=os.getenv("X_ACCESS_SECRET")
)

# =========================
# ุดุฎุตูุฉ ุงูุจูุช ุงูุฃุฏุจูุฉ
# =========================
SYSTEM_PROMPT = """
ุฃูุช ูุงุชุจ ุฃุฏุจู ุนุฑุจู ูุญุชุฑู.
ุชูุชุจ ูุตูุตูุง ุฃุฏุจูุฉ ูุตูุฑุฉ ุฌุฏูุงุ ููุซูุฉุ ูุนูููุฉ.

ุงูููุถูุนุงุช ุงููุณููุญ ุจูุง ููุท:
- ุงูุญุจ
- ุงูุญุฒู
- ุงูุฎุณุงุฑุฉ
- ุงูุฃูู
- ุงูููุฏ
- ุงูุทููุญ

ุฃุณููุจ ุงููุชุงุจุฉ:
- ุฃุฏุจู ุฑููุน
- ุดุงุนุฑู
- ุนุงุทูู
- ุตุงุฏู
- ูุงุฏุฆ
- ุนููู
- ุบูุฑ ุฎุทุงุจู
- ูุนุชูุฏ ุนูู ุงูุตูุฑุฉ ูุงูุฑูุฒ

ููุงุนุฏ ุตุงุฑูุฉ:
- ููููุน ุงูุณูุงุณุฉ
- ููููุน ุงูุฌูุณ
- ููููุน ุงูุดุชุงุฆู
- ููููุน ุงูุฅุณุงุกุฉ
- ููููุน ุงููุงุดุชุงุบุงุช
- ููููุน ุงูุณุฎุฑูุฉ
- ููููุน ุงูุชุณููู
- ููููุน ุงููุตุงุฆุญ ุงููุจุงุดุฑุฉ
- ูุง ุชุณุชุฎุฏู ุงูุฅูููุฌู

ุงูุดูู:
- ุงุจุฏุฃ ุฏุงุฆููุง ุจุฌููุฉ Hook ูููุฉ
- ุงููุต ูุง ูุชุฌุงูุฒ 3โ5 ุฃุณุทุฑ
- ุงุฎุชู ุฃุญูุงููุง ุจุณุคุงู ุนุงุทูู ูุงุฏุฆ
- ูุง ุชุฐูุฑ ุงุณู ุงููุงุชุจ
"""

# =========================
# ุชูููุฏ ุชุบุฑูุฏุฉ ุฃุฏุจูุฉ
# =========================
def generate_post():
    prompt = "ุงูุชุจ ูุตูุง ุฃุฏุจููุง ูุตูุฑูุง ุฌุฏูุง ูุตูุญ ูุชุบุฑูุฏุฉุ ุจูุบุฉ ุนุฑุจูุฉ ุฌูููุฉ ููุคุซุฑุฉ."

    response = openai_client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": prompt}
        ],
        temperature=0.8,
        max_tokens=200
    )

    return response.choices[0].message.content.strip()

# =========================
# ูุดุฑ ุงูุชุบุฑูุฏุฉ
# =========================
def post():
    try:
        print("๐ฆ ูุดุฑ ุชุบุฑูุฏุฉ ุฃุฏุจูุฉ...")

        tweet = generate_post()
        response = client.create_tweet(text=tweet)

        tweet_id = response.data.get("id") if response.data else None
        if not tweet_id:
            print("โ ูุดู ุงููุดุฑ: ูู ูุชู ุงุณุชูุงู ID")
            return

        print("โ ููุดุฑุช ุงูุชุบุฑูุฏุฉ ุจูุฌุงุญ | ID:", tweet_id)

    except Exception as e:
        print("โ ุฎุทุฃ ุฃุซูุงุก ุงููุดุฑ:", e)

# =========================
# ุชุดุบูู ุงูุจูุช
# =========================
if __name__ == "__main__":
    post()
